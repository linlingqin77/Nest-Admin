generator client {
  provider = "prisma-client-js"
}

// Prisma 默认使用 DATABASE_URL，但我们会在 Nest 的 PrismaService 中按需注入连接串。
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== 租户相关表 ====================

/// 租户表
model SysTenant {
  id              Int       @id @default(autoincrement())
  tenantId        String    @unique @map("tenant_id") @db.VarChar(20)
  contactUserName String?   @map("contact_user_name") @db.VarChar(50)
  contactPhone    String?   @map("contact_phone") @db.VarChar(20)
  companyName     String    @map("company_name") @db.VarChar(100)
  licenseNumber   String?   @map("license_number") @db.VarChar(50)
  address         String?   @db.VarChar(200)
  intro           String?   @db.Text
  domain          String?   @db.VarChar(100)
  packageId       Int?      @map("package_id")
  expireTime      DateTime? @map("expire_time") @db.Timestamp(6)
  accountCount    Int       @default(-1) @map("account_count")
  storageQuota    Int       @default(10240) @map("storage_quota") // 存储配额(MB)，默认10GB
  storageUsed     Int       @default(0) @map("storage_used") // 已使用存储(MB)
  apiQuota        Int       @default(10000) @map("api_quota") // API日调用量配额，默认10000次，-1表示无限制
  status          String    @default("0") @db.Char(1)
  delFlag         String    @default("0") @map("del_flag") @db.Char(1)
  createBy        String    @default("") @map("create_by") @db.VarChar(64)
  createTime      DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy        String    @default("") @map("update_by") @db.VarChar(64)
  updateTime      DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark          String?   @db.VarChar(500)

  @@map("sys_tenant")
}

/// 租户套餐表
model SysTenantPackage {
  packageId          Int       @id @default(autoincrement()) @map("package_id")
  packageName        String    @map("package_name") @db.VarChar(50)
  menuIds            String?   @map("menu_ids") @db.Text
  menuCheckStrictly  Boolean   @default(false) @map("menu_check_strictly")
  status             String    @default("0") @db.Char(1)
  delFlag            String    @default("0") @map("del_flag") @db.Char(1)
  createBy           String    @default("") @map("create_by") @db.VarChar(64)
  createTime         DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy           String    @default("") @map("update_by") @db.VarChar(64)
  updateTime         DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark             String?   @db.VarChar(500)

  @@map("sys_tenant_package")
}

/// 客户端表
model SysClient {
  id            Int       @id @default(autoincrement())
  clientId      String    @unique @map("client_id") @db.VarChar(64)
  clientKey     String    @map("client_key") @db.VarChar(64)
  clientSecret  String    @map("client_secret") @db.VarChar(255)
  grantTypeList String?   @map("grant_type_list") @db.VarChar(255)
  deviceType    String?   @map("device_type") @db.VarChar(20)
  activeTimeout Int       @default(1800) @map("active_timeout")
  timeout       Int       @default(86400)
  status        String    @default("0") @db.Char(1)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@map("sys_client")
}

// ==================== 业务表 ====================

// ==================== 代码生成器相关表 ====================

/// 数据源配置表
model GenDataSource {
  id          Int       @id @default(autoincrement())
  tenantId    String    @map("tenant_id") @db.VarChar(20)
  name        String    @db.VarChar(100)
  type        String    @db.VarChar(20) // postgresql, mysql, sqlite
  host        String    @db.VarChar(255)
  port        Int
  database    String    @db.VarChar(100)
  username    String    @db.VarChar(100)
  password    String    @db.VarChar(500) // 加密存储
  status      String    @default("0") @db.Char(1)
  delFlag     String    @default("0") @map("del_flag") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark      String?   @db.VarChar(500)

  tables      GenTable[]

  @@unique([tenantId, name])
  @@index([tenantId, status])
  @@map("gen_data_source")
}

/// 模板组表
model GenTemplateGroup {
  id          Int       @id @default(autoincrement())
  tenantId    String?   @map("tenant_id") @db.VarChar(20) // null 表示系统级
  name        String    @db.VarChar(100)
  description String?   @db.VarChar(500)
  isDefault   Boolean   @default(false) @map("is_default")
  status      String    @default("0") @db.Char(1)
  delFlag     String    @default("0") @map("del_flag") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  templates   GenTemplate[]
  tables      GenTable[]
  histories   GenHistory[]

  @@unique([tenantId, name])
  @@index([tenantId, status])
  @@map("gen_template_group")
}

/// 模板表
model GenTemplate {
  id          Int       @id @default(autoincrement())
  groupId     Int       @map("group_id")
  name        String    @db.VarChar(100)
  fileName    String    @map("file_name") @db.VarChar(200) // 输出文件名模板
  filePath    String    @map("file_path") @db.VarChar(500) // 输出路径模板
  content     String    @db.Text
  language    String    @db.VarChar(20) // typescript, vue, sql
  sort        Int       @default(0)
  status      String    @default("0") @db.Char(1)
  delFlag     String    @default("0") @map("del_flag") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  group       GenTemplateGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([status])
  @@map("gen_template")
}

/// 生成历史表
model GenHistory {
  id              Int       @id @default(autoincrement())
  tenantId        String    @map("tenant_id") @db.VarChar(20)
  tableId         Int       @map("table_id")
  tableName       String    @map("table_name") @db.VarChar(200)
  templateGroupId Int       @map("template_group_id")
  snapshot        String    @db.Text // JSON 存储
  generatedBy     String    @map("generated_by") @db.VarChar(64)
  generatedAt     DateTime  @map("generated_at") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  table           GenTable         @relation(fields: [tableId], references: [tableId], onDelete: Cascade)
  templateGroup   GenTemplateGroup @relation(fields: [templateGroupId], references: [id])

  @@index([tenantId, tableId])
  @@index([generatedAt])
  @@map("gen_history")
}

/// 代码生成表配置
model GenTable {
  tableId         Int       @id @default(autoincrement()) @map("table_id")
  tenantId        String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dataSourceId    Int?      @map("data_source_id")
  templateGroupId Int?      @map("template_group_id")
  tableName       String    @map("table_name") @db.VarChar(200)
  tableComment    String    @map("table_comment") @db.VarChar(500)
  subTableName    String?   @map("sub_table_name") @db.VarChar(64)
  subTableFkName  String?   @map("sub_table_fk_name") @db.VarChar(64)
  className       String    @map("class_name") @db.VarChar(100)
  tplCategory     String    @map("tpl_category") @db.VarChar(200)
  tplWebType      String    @map("tpl_web_type") @db.VarChar(30)
  packageName     String    @map("package_name") @db.VarChar(100)
  moduleName      String    @map("module_name") @db.VarChar(30)
  businessName    String    @map("business_name") @db.VarChar(30)
  functionName    String    @map("function_name") @db.VarChar(50)
  functionAuthor  String    @map("function_author") @db.VarChar(50)
  genType         String    @map("gen_type") @db.Char(1)
  genPath         String    @map("gen_path") @db.VarChar(200)
  options         String    @db.VarChar(1000)
  status          String    @db.Char(1)
  delFlag         String    @map("del_flag") @db.Char(1)
  createBy        String    @map("create_by") @db.VarChar(64)
  createTime      DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy        String    @map("update_by") @db.VarChar(64)
  updateTime      DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark          String?   @db.VarChar(500)

  columns         GenTableColumn[]
  dataSource      GenDataSource?   @relation(fields: [dataSourceId], references: [id])
  templateGroup   GenTemplateGroup? @relation(fields: [templateGroupId], references: [id])
  histories       GenHistory[]

  @@index([tenantId, delFlag])
  @@index([dataSourceId])
  @@index([templateGroupId])
  @@map("gen_table")
}

model GenTableColumn {
  columnId     Int       @id @default(autoincrement()) @map("column_id")
  tableId      Int       @map("table_id")
  columnName   String    @map("column_name") @db.VarChar(200)
  columnComment String   @map("column_comment") @db.VarChar(500)
  columnType   String    @map("column_type") @db.VarChar(100)
  javaType     String    @map("java_type") @db.VarChar(500)
  javaField    String    @map("java_field") @db.VarChar(200)
  isPk         String    @map("is_pk") @db.Char(1)
  isIncrement  String    @map("is_increment") @db.Char(1)
  isRequired   String    @map("is_required") @db.Char(1)
  isInsert     String    @map("is_insert") @db.Char(1)
  isEdit       String?   @map("is_edit") @db.Char(1)
  isList       String?   @map("is_list") @db.Char(1)
  isQuery      String?   @map("is_query") @db.Char(1)
  queryType    String    @map("query_type") @db.VarChar(200)
  htmlType     String    @map("html_type") @db.VarChar(200)
  dictType     String    @map("dict_type") @db.VarChar(200)
  columnDefault String?  @map("column_default") @db.VarChar(200)
  sort         Int       @db.Integer
  status       String    @db.Char(1)
  delFlag      String    @map("del_flag") @db.Char(1)
  createBy     String    @map("create_by") @db.VarChar(64)
  createTime   DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy     String    @map("update_by") @db.VarChar(64)
  updateTime   DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark       String?   @db.VarChar(500)

  table GenTable @relation(fields: [tableId], references: [tableId], onDelete: Cascade)

  @@map("gen_table_column")
}

/// 系统级配置表（全局，无租户隔离）
model SysSystemConfig {
  configId    Int       @id @default(autoincrement()) @map("config_id")
  configName  String    @map("config_name") @db.VarChar(100)
  configKey   String    @unique @map("config_key") @db.VarChar(100)
  configValue String    @map("config_value") @db.VarChar(500)
  configType  String    @map("config_type") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark      String?   @db.VarChar(500)
  status      String    @default("0") @db.Char(1)
  delFlag     String    @default("0") @map("del_flag") @db.Char(1)

  @@index([status])
  @@index([configType])
  @@index([delFlag, status])
  @@index([createTime])
  @@map("sys_system_config")
}

/// 租户级配置表（多租户隔离）
model SysConfig {
  configId    Int       @id @default(autoincrement()) @map("config_id")
  tenantId    String    @default("000000") @map("tenant_id") @db.VarChar(20)
  configName  String    @map("config_name") @db.VarChar(100)
  configKey   String    @map("config_key") @db.VarChar(100)
  configValue String    @map("config_value") @db.VarChar(500)
  configType  String    @map("config_type") @db.Char(1)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark      String?   @db.VarChar(500)
  status      String    @default("0") @db.Char(1)
  delFlag     String    @default("0") @map("del_flag") @db.Char(1)

  @@unique([tenantId, configKey], name: "unique_tenant_config_key")
  @@index([tenantId, status])
  @@index([tenantId, configType])
  @@index([tenantId, delFlag, status])
  @@index([configKey])
  @@index([createTime])
  @@map("sys_config")
}

model SysDept {
  deptId    Int       @id @default(autoincrement()) @map("dept_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  parentId  Int       @map("parent_id")
  ancestors String    @db.VarChar(50)
  deptName  String    @map("dept_name") @db.VarChar(30)
  orderNum  Int       @map("order_num")
  leader    String    @default("") @db.VarChar(20)
  phone     String    @default("") @db.VarChar(11)
  email     String    @default("") @db.VarChar(50)
  status    String    @default("0") @db.Char(1)
  delFlag   String    @default("0") @map("del_flag") @db.Char(1)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, parentId])
  @@index([status])
  @@index([tenantId, delFlag, status])
  @@index([parentId])
  @@map("sys_dept")
}

model SysDictData {
  dictCode   Int       @id @default(autoincrement()) @map("dict_code")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dictSort   Int       @default(0) @map("dict_sort")
  dictLabel  String    @map("dict_label") @db.VarChar(100)
  dictValue  String    @map("dict_value") @db.VarChar(100)
  dictType   String    @map("dict_type") @db.VarChar(100)
  cssClass   String    @default("") @map("css_class") @db.VarChar(100)
  listClass  String    @default("") @map("list_class") @db.VarChar(100)
  isDefault  String    @default("N") @map("is_default") @db.Char(1)
  status     String    @default("0") @db.Char(1)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark     String?   @db.VarChar(500)
  delFlag    String    @default("0") @map("del_flag") @db.Char(1)

  @@unique([tenantId, dictType, dictValue], name: "unique_tenant_dict_data")
  @@index([tenantId, dictType, status])
  @@index([dictType])
  @@map("sys_dict_data")
}

model SysDictType {
  dictId    Int       @id @default(autoincrement()) @map("dict_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  dictName  String    @map("dict_name") @db.VarChar(100)
  dictType  String    @map("dict_type") @db.VarChar(100)
  status    String    @default("0") @db.Char(1)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)
  delFlag   String    @default("0") @map("del_flag") @db.Char(1)

  @@unique([tenantId, dictType], name: "unique_tenant_dict_type")
  @@index([tenantId, status])
  @@index([dictType])
  @@map("sys_dict_type")
}

model SysJob {
  jobId          Int       @id @default(autoincrement()) @map("job_id")
  tenantId       String    @default("000000") @map("tenant_id") @db.VarChar(20)
  jobName        String    @map("job_name") @db.VarChar(64)
  jobGroup       String    @map("job_group") @db.VarChar(64)
  invokeTarget   String    @map("invoke_target") @db.VarChar(500)
  cronExpression String?   @map("cron_expression") @db.VarChar(255)
  misfirePolicy  String?   @map("misfire_policy") @db.VarChar(20)
  concurrent     String?   @db.Char(1)
  status         String?   @db.Char(1)
  createBy       String    @map("create_by") @db.VarChar(64)
  createTime     DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy       String    @map("update_by") @db.VarChar(64)
  updateTime     DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark         String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([invokeTarget])
  @@map("sys_job")
}

model SysJobLog {
  jobLogId     Int       @id @default(autoincrement()) @map("job_log_id")
  jobName      String    @map("job_name") @db.VarChar(64)
  jobGroup     String    @map("job_group") @db.VarChar(64)
  invokeTarget String    @map("invoke_target") @db.VarChar(500)
  jobMessage   String?   @map("job_message") @db.VarChar(500)
  status       String    @db.Char(1)
  exceptionInfo String?  @map("exception_info") @db.VarChar(2000)
  createTime   DateTime  @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@map("sys_job_log")
}

model SysLogininfor {
  infoId        Int       @id @default(autoincrement()) @map("info_id")
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  userName      String    @map("user_name") @db.VarChar(50)
  ipaddr        String    @db.VarChar(128)
  loginLocation String    @default("") @map("login_location") @db.VarChar(255)
  browser       String    @db.VarChar(50)
  os            String    @db.VarChar(50)
  deviceType    String    @default("0") @map("device_type") @db.Char(1)
  status        String    @db.Char(1)
  msg           String    @db.VarChar(255)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)
  loginTime     DateTime  @map("login_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@index([tenantId, loginTime])
  @@index([userName])
  @@index([status])
  @@index([loginTime])
  @@index([tenantId, userName, loginTime])
  @@index([tenantId, status, loginTime])
  @@map("sys_logininfor")
}

model SysMenu {
  menuId    Int       @id @default(autoincrement()) @map("menu_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  menuName  String    @map("menu_name") @db.VarChar(50)
  parentId  Int       @map("parent_id")
  orderNum  Int       @map("order_num")
  path      String    @default("") @db.VarChar(200)
  component String?   @db.VarChar(255)
  query     String    @default("") @db.VarChar(255)
  isFrame   String    @map("is_frame") @db.Char(1)
  isCache   String    @map("is_cache") @db.Char(1)
  menuType  String    @map("menu_type") @db.Char(1)
  visible   String    @db.Char(1)
  status    String    @db.Char(1)
  perms     String    @default("") @db.VarChar(100)
  icon      String    @default("") @db.VarChar(100)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)
  delFlag   String    @default("0") @map("del_flag") @db.Char(1)

  @@index([tenantId, status])
  @@index([tenantId, parentId])
  @@index([status])
  @@index([tenantId, delFlag, status])
  @@index([parentId, orderNum])
  @@map("sys_menu")
}

model SysNotice {
  noticeId      Int       @id @default(autoincrement()) @map("notice_id")
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  noticeTitle   String    @map("notice_title") @db.VarChar(50)
  noticeType    String    @map("notice_type") @db.Char(1)
  noticeContent String?   @map("notice_content") @db.Text
  status        String    @default("0") @db.Char(1)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)
  remark        String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, noticeType])
  @@index([tenantId, createTime])
  @@index([tenantId, delFlag, status])
  @@index([createTime])
  @@map("sys_notice")
}

model SysOperLog {
  operId       Int       @id @default(autoincrement()) @map("oper_id")
  tenantId     String    @default("000000") @map("tenant_id") @db.VarChar(20)
  title        String    @db.VarChar(50)
  businessType Int       @map("business_type")
  requestMethod String   @map("request_method") @db.VarChar(10)
  operatorType Int       @map("operator_type")
  operName     String    @map("oper_name") @db.VarChar(50)
  deptName     String    @map("dept_name") @db.VarChar(50)
  operUrl      String    @map("oper_url") @db.VarChar(255)
  operLocation String    @map("oper_location") @db.VarChar(255)
  operParam    String    @map("oper_param") @db.VarChar(2000)
  jsonResult   String    @map("json_result") @db.VarChar(2000)
  errorMsg     String    @map("error_msg") @db.VarChar(2000)
  method       String    @db.VarChar(100)
  operIp       String    @map("oper_ip") @db.VarChar(255)
  operTime     DateTime  @map("oper_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  status       String    @db.Char(1)
  costTime     Int       @map("cost_time")

  @@index([tenantId, operTime])
  @@index([operName])
  @@index([status])
  @@index([operTime])
  @@index([businessType])
  @@index([tenantId, status, operTime])
  @@index([tenantId, operName, operTime])
  @@map("sys_oper_log")
}

model SysPost {
  postId    Int       @id @default(autoincrement()) @map("post_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  deptId    Int?      @map("dept_id")
  postCode  String    @map("post_code") @db.VarChar(64)
  postCategory String? @map("post_category") @db.VarChar(100)
  postName  String    @map("post_name") @db.VarChar(50)
  postSort  Int       @default(0) @map("post_sort")
  status    String    @default("0") @db.Char(1)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)
  delFlag   String    @default("0") @map("del_flag") @db.Char(1)

  @@index([tenantId, status])
  @@index([deptId])
  @@index([tenantId, delFlag, status])
  @@map("sys_post")
}

model SysRole {
  roleId           Int       @id @default(autoincrement()) @map("role_id")
  tenantId         String    @default("000000") @map("tenant_id") @db.VarChar(20)
  roleName         String    @map("role_name") @db.VarChar(30)
  roleKey          String    @map("role_key") @db.VarChar(100)
  roleSort         Int       @map("role_sort")
  dataScope        String    @default("1") @map("data_scope") @db.Char(1)
  menuCheckStrictly Boolean  @map("menu_check_strictly") @default(false)
  deptCheckStrictly Boolean  @map("dept_check_strictly") @default(false)
  status           String    @default("0") @db.Char(1)
  delFlag          String    @default("0") @map("del_flag") @db.Char(1)
  createBy         String    @default("") @map("create_by") @db.VarChar(64)
  createTime       DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy         String    @default("") @map("update_by") @db.VarChar(64)
  updateTime       DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark           String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, delFlag, status])
  @@index([tenantId, roleKey])
  @@index([roleKey])
  @@map("sys_role")
}

model SysRoleDept {
  roleId Int @map("role_id")
  deptId Int @map("dept_id")

  @@id([roleId, deptId])
  @@map("sys_role_dept")
}

model SysRoleMenu {
  roleId Int @map("role_id")
  menuId Int @map("menu_id")

  @@id([roleId, menuId])
  @@index([roleId])
  @@index([menuId])
  @@map("sys_role_menu")
}

/// 文件夹表
model SysFileFolder {
  folderId   Int       @id @default(autoincrement()) @map("folder_id")
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  parentId   Int       @default(0) @map("parent_id")
  folderName String    @map("folder_name") @db.VarChar(100)
  folderPath String    @map("folder_path") @db.VarChar(500)
  orderNum   Int       @default(0) @map("order_num")
  status     String    @default("0") @db.Char(1)
  delFlag    String    @default("0") @map("del_flag") @db.Char(1)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark     String?   @db.VarChar(500)

  @@index([tenantId, parentId])
  @@map("sys_file_folder")
}

/// 文件表（扩展原 SysUpload）
model SysUpload {
  uploadId      String    @id @map("upload_id") @db.VarChar(255)
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  folderId      Int       @default(0) @map("folder_id")
  size          Int
  fileName      String    @map("file_name") @db.VarChar(255)
  newFileName   String    @map("new_file_name") @db.VarChar(255)
  url           String    @db.VarChar(500)
  ext           String?   @db.VarChar(50)
  mimeType      String?   @map("mime_type") @db.VarChar(100)
  storageType   String    @default("local") @map("storage_type") @db.VarChar(20)
  fileMd5       String?   @map("file_md5") @db.VarChar(32)
  thumbnail     String?   @db.VarChar(500) // 缩略图URL
  parentFileId  String?   @map("parent_file_id") @db.VarChar(255) // 父文件ID（用于版本控制）
  version       Int       @default(1) // 版本号
  isLatest      Boolean   @default(true) @map("is_latest") // 是否最新版本
  downloadCount Int       @default(0) @map("download_count")
  status        String    @default("0") @db.Char(1)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark        String?   @db.VarChar(500)

  // Relations
  shares        SysFileShare[]

  @@index([tenantId, folderId])
  @@index([fileMd5, delFlag])
  @@index([parentFileId, version])
  @@map("sys_upload")
}

/// 文件分享表
model SysFileShare {
  shareId    String    @id @default(uuid()) @map("share_id") @db.VarChar(64)
  tenantId   String    @default("000000") @map("tenant_id") @db.VarChar(20)
  uploadId   String    @map("upload_id") @db.VarChar(255)
  shareCode  String?   @map("share_code") @db.VarChar(6)
  expireTime DateTime? @map("expire_time") @db.Timestamp(6)
  maxDownload Int      @default(-1) @map("max_download")
  downloadCount Int    @default(0) @map("download_count")
  status     String    @default("0") @db.Char(1)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  
  // Relations
  upload     SysUpload @relation(fields: [uploadId], references: [uploadId], onDelete: Cascade)

  @@index([shareId, shareCode])
  @@index([uploadId])
  @@map("sys_file_share")
}

model SysUser {
  userId    Int       @id @default(autoincrement()) @map("user_id")
  tenantId  String    @default("000000") @map("tenant_id") @db.VarChar(20)
  deptId    Int?      @map("dept_id")
  userName  String    @map("user_name") @db.VarChar(30)
  nickName  String    @map("nick_name") @db.VarChar(30)
  userType  String    @map("user_type") @db.VarChar(2)
  email     String    @default("") @db.VarChar(50)
  phonenumber String  @default("") @db.VarChar(11)
  sex       String    @default("0") @db.Char(1)
  avatar    String    @default("") @db.VarChar(255)
  password  String    @db.VarChar(200)
  status    String    @default("0") @db.Char(1)
  delFlag   String    @default("0") @map("del_flag") @db.Char(1)
  loginIp   String    @default("") @map("login_ip") @db.VarChar(128)
  loginDate DateTime? @map("login_date") @db.Timestamp(6)
  createBy  String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy  String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  remark    String?   @db.VarChar(500)

  @@index([tenantId, status])
  @@index([tenantId, userName])
  @@index([tenantId, createTime])
  @@index([tenantId, phonenumber])
  @@index([tenantId, email])
  @@index([tenantId, delFlag, status])
  @@index([userName])
  @@index([deptId])
  @@index([status])
  @@index([phonenumber])
  @@index([email])
  @@map("sys_user")
}

model SysUserPost {
  userId Int @map("user_id")
  postId Int @map("post_id")

  @@id([userId, postId])
  @@index([postId])
  @@map("sys_user_post")
}

model SysUserRole {
  userId Int @map("user_id")
  roleId Int @map("role_id")

  @@id([userId, roleId])
  @@index([roleId])
  @@map("sys_user_role")
}

/// 审计日志表
model SysAuditLog {
  id          Int       @id @default(autoincrement())
  tenantId    String    @map("tenant_id") @db.VarChar(20)
  userId      Int?      @map("user_id")
  userName    String?   @map("user_name") @db.VarChar(50)
  action      String    @db.VarChar(100)
  module      String    @db.VarChar(50)
  targetType  String?   @map("target_type") @db.VarChar(50)
  targetId    String?   @map("target_id") @db.VarChar(100)
  oldValue    String?   @map("old_value") @db.Text
  newValue    String?   @map("new_value") @db.Text
  ip          String    @db.VarChar(128)
  userAgent   String?   @map("user_agent") @db.VarChar(500)
  requestId   String?   @map("request_id") @db.VarChar(64)
  status      String    @db.Char(1)
  errorMsg    String?   @map("error_msg") @db.VarChar(2000)
  duration    Int       @default(0)
  createTime  DateTime  @map("create_time") @default(now())

  @@index([tenantId, createTime])
  @@index([userId, createTime])
  @@index([action])
  @@index([module])
  @@index([targetType, targetId])
  @@map("sys_audit_log")
}

/// 租户功能开关表 (需求 5.1)
model SysTenantFeature {
  id          Int       @id @default(autoincrement())
  tenantId    String    @map("tenant_id") @db.VarChar(20)
  featureKey  String    @map("feature_key") @db.VarChar(100)
  enabled     Boolean   @default(false)
  config      String?   @db.Text
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime  @map("create_time") @default(now())
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime  @map("update_time") @updatedAt

  @@unique([tenantId, featureKey])
  @@index([tenantId])
  @@index([featureKey])
  @@map("sys_tenant_feature")
}

/// 租户使用统计表 (需求 5.5, 5.6)
model SysTenantUsage {
  id          Int       @id @default(autoincrement())
  tenantId    String    @map("tenant_id") @db.VarChar(20)
  date        DateTime  @db.Date
  apiCalls    Int       @default(0) @map("api_calls")
  storageUsed Int       @default(0) @map("storage_used")
  userCount   Int       @default(0) @map("user_count")
  createTime  DateTime  @map("create_time") @default(now())

  @@unique([tenantId, date])
  @@index([tenantId, date])
  @@map("sys_tenant_usage")
}


// ==================== 短信管理相关表 ====================

/// 短信渠道表
model SysSmsChannel {
  id          Int       @id @default(autoincrement())
  code        String    @unique @db.VarChar(50)  // 渠道编码：aliyun, tencent, huawei
  name        String    @db.VarChar(100)         // 渠道名称
  signature   String    @db.VarChar(100)         // 短信签名
  apiKey      String    @map("api_key") @db.VarChar(255)
  apiSecret   String    @map("api_secret") @db.VarChar(255)  // 加密存储
  callbackUrl String?   @map("callback_url") @db.VarChar(500)
  status      String    @default("0") @db.Char(1)  // 0-禁用 1-启用
  remark      String?   @db.VarChar(500)
  createBy    String    @default("") @map("create_by") @db.VarChar(64)
  createTime  DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy    String    @default("") @map("update_by") @db.VarChar(64)
  updateTime  DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag     String    @default("0") @map("del_flag") @db.Char(1)

  templates   SysSmsTemplate[]

  @@index([status])
  @@index([code])
  @@map("sys_sms_channel")
}

/// 短信模板表
model SysSmsTemplate {
  id            Int       @id @default(autoincrement())
  channelId     Int       @map("channel_id")
  code          String    @unique @db.VarChar(100)  // 模板编码
  name          String    @db.VarChar(100)          // 模板名称
  content       String    @db.Text                  // 模板内容
  params        String?   @db.Text                  // 参数列表 JSON数组
  apiTemplateId String    @map("api_template_id") @db.VarChar(100)  // 第三方模板ID
  type          Int       @default(1)               // 1-验证码 2-通知 3-营销
  status        String    @default("0") @db.Char(1)
  remark        String?   @db.VarChar(500)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)

  channel       SysSmsChannel @relation(fields: [channelId], references: [id])

  @@index([channelId])
  @@index([status])
  @@index([type])
  @@map("sys_sms_template")
}

/// 短信发送日志表
model SysSmsLog {
  id             BigInt    @id @default(autoincrement())
  channelId      Int       @map("channel_id")
  channelCode    String    @map("channel_code") @db.VarChar(50)
  templateId     Int       @map("template_id")
  templateCode   String    @map("template_code") @db.VarChar(100)
  mobile         String    @db.VarChar(20)
  content        String    @db.Text
  params         String?   @db.Text                  // JSON对象
  sendStatus     Int       @default(0) @map("send_status")  // 0-发送中 1-成功 2-失败
  sendTime       DateTime  @default(now()) @map("send_time") @db.Timestamp(6)
  receiveStatus  Int?      @map("receive_status")    // 0-未接收 1-已接收
  receiveTime    DateTime? @map("receive_time") @db.Timestamp(6)
  apiSendCode    String?   @map("api_send_code") @db.VarChar(100)
  apiReceiveCode String?   @map("api_receive_code") @db.VarChar(100)
  errorMsg       String?   @map("error_msg") @db.Text

  @@index([mobile])
  @@index([sendTime])
  @@index([sendStatus])
  @@index([templateCode])
  @@map("sys_sms_log")
}

// ==================== 邮件管理相关表 ====================

/// 邮箱账号表
model SysMailAccount {
  id         Int       @id @default(autoincrement())
  mail       String    @unique @db.VarChar(255)    // 邮箱地址
  username   String    @db.VarChar(255)            // 用户名
  password   String    @db.VarChar(255)            // 密码（加密存储）
  host       String    @db.VarChar(255)            // SMTP主机
  port       Int                                   // SMTP端口
  sslEnable  Boolean   @default(false) @map("ssl_enable")
  status     String    @default("0") @db.Char(1)
  remark     String?   @db.VarChar(500)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag    String    @default("0") @map("del_flag") @db.Char(1)

  templates  SysMailTemplate[]

  @@index([status])
  @@map("sys_mail_account")
}

/// 邮件模板表
model SysMailTemplate {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(100)            // 模板名称
  code       String    @unique @db.VarChar(100)    // 模板编码
  accountId  Int       @map("account_id")          // 发送账号
  nickname   String    @db.VarChar(100)            // 发送人昵称
  title      String    @db.VarChar(255)            // 邮件标题
  content    String    @db.Text                    // 邮件内容（HTML）
  params     String?   @db.Text                    // 参数列表 JSON数组
  status     String    @default("0") @db.Char(1)
  remark     String?   @db.VarChar(500)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag    String    @default("0") @map("del_flag") @db.Char(1)

  account    SysMailAccount @relation(fields: [accountId], references: [id])

  @@index([accountId])
  @@index([status])
  @@map("sys_mail_template")
}

/// 邮件发送日志表
model SysMailLog {
  id               BigInt    @id @default(autoincrement())
  userId           Int?      @map("user_id")
  userType         Int?      @map("user_type")
  toMail           String    @map("to_mail") @db.VarChar(255)
  accountId        Int       @map("account_id")
  fromMail         String    @map("from_mail") @db.VarChar(255)
  templateId       Int       @map("template_id")
  templateCode     String    @map("template_code") @db.VarChar(100)
  templateNickname String    @map("template_nickname") @db.VarChar(100)
  templateTitle    String    @map("template_title") @db.VarChar(255)
  templateContent  String    @map("template_content") @db.Text
  templateParams   String?   @map("template_params") @db.Text
  sendStatus       Int       @default(0) @map("send_status")  // 0-发送中 1-成功 2-失败
  sendTime         DateTime  @default(now()) @map("send_time") @db.Timestamp(6)
  errorMsg         String?   @map("error_msg") @db.Text

  @@index([toMail])
  @@index([sendTime])
  @@index([sendStatus])
  @@index([templateCode])
  @@map("sys_mail_log")
}

// ==================== 站内信相关表 ====================

/// 站内信模板表
model SysNotifyTemplate {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(100)            // 模板名称
  code       String    @unique @db.VarChar(100)    // 模板编码
  nickname   String    @db.VarChar(100)            // 发送人名称
  content    String    @db.Text                    // 模板内容
  params     String?   @db.Text                    // 参数列表 JSON数组
  type       Int       @default(1)                 // 1-系统通知 2-业务通知
  status     String    @default("0") @db.Char(1)
  remark     String?   @db.VarChar(500)
  createBy   String    @default("") @map("create_by") @db.VarChar(64)
  createTime DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy   String    @default("") @map("update_by") @db.VarChar(64)
  updateTime DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  delFlag    String    @default("0") @map("del_flag") @db.Char(1)

  @@index([status])
  @@index([type])
  @@map("sys_notify_template")
}

/// 站内信消息表
model SysNotifyMessage {
  id               BigInt    @id @default(autoincrement())
  tenantId         String    @default("000000") @map("tenant_id") @db.VarChar(20)
  userId           Int       @map("user_id")
  userType         Int       @default(1) @map("user_type")
  templateId       Int       @map("template_id")
  templateCode     String    @map("template_code") @db.VarChar(100)
  templateNickname String    @map("template_nickname") @db.VarChar(100)
  templateContent  String    @map("template_content") @db.Text
  templateParams   String?   @map("template_params") @db.Text
  readStatus       Boolean   @default(false) @map("read_status")
  readTime         DateTime? @map("read_time") @db.Timestamp(6)
  delFlag          String    @default("0") @map("del_flag") @db.Char(1)
  createTime       DateTime  @default(now()) @map("create_time") @db.Timestamp(6)

  @@index([tenantId, userId])
  @@index([userId, readStatus])
  @@index([createTime])
  @@map("sys_notify_message")
}

// ==================== 租户增强相关表 ====================

/// 租户配额表
model SysTenantQuota {
  id           Int       @id @default(autoincrement())
  tenantId     String    @unique @map("tenant_id") @db.VarChar(20)
  userQuota    Int       @default(-1) @map("user_quota")      // 用户数量配额，-1表示不限
  userUsed     Int       @default(0) @map("user_used")        // 已使用用户数
  storageQuota BigInt    @default(-1) @map("storage_quota")   // 存储配额（MB），-1表示不限
  storageUsed  BigInt    @default(0) @map("storage_used")     // 已使用存储（MB）
  apiQuota     Int       @default(-1) @map("api_quota")       // API调用配额（月），-1表示不限
  apiUsed      Int       @default(0) @map("api_used")         // 本月已调用次数
  createTime   DateTime  @default(now()) @map("create_time") @db.Timestamp(6)
  updateTime   DateTime  @updatedAt @map("update_time") @db.Timestamp(6)

  @@index([tenantId])
  @@map("sys_tenant_quota")
}

/// 配额变更记录表
model SysTenantQuotaLog {
  id         Int       @id @default(autoincrement())
  tenantId   String    @map("tenant_id") @db.VarChar(20)
  quotaType  String    @map("quota_type") @db.VarChar(50)  // user, storage, api
  oldValue   BigInt    @map("old_value")
  newValue   BigInt    @map("new_value")
  changeBy   String    @map("change_by") @db.VarChar(64)
  changeTime DateTime  @default(now()) @map("change_time") @db.Timestamp(6)

  @@index([tenantId])
  @@index([changeTime])
  @@map("sys_tenant_quota_log")
}

/// 租户账单表
model SysTenantBilling {
  id          Int       @id @default(autoincrement())
  billNo      String    @unique @map("bill_no") @db.VarChar(50)  // 账单编号
  tenantId    String    @map("tenant_id") @db.VarChar(20)
  amount      Decimal   @db.Decimal(10, 2)                       // 账单金额
  cycle       String    @db.VarChar(20)                          // monthly, quarterly, yearly
  status      String    @default("pending") @db.VarChar(20)      // pending, paid, cancelled, overdue
  dueDate     DateTime  @map("due_date") @db.Timestamp(6)        // 到期日
  paidTime    DateTime? @map("paid_time") @db.Timestamp(6)       // 支付时间
  remark      String?   @db.VarChar(500)
  createBy    String    @map("create_by") @db.VarChar(64)
  createTime  DateTime  @default(now()) @map("create_time") @db.Timestamp(6)
  updateTime  DateTime  @updatedAt @map("update_time") @db.Timestamp(6)

  items       SysTenantBillingItem[]

  @@index([tenantId])
  @@index([status])
  @@index([dueDate])
  @@index([createTime])
  @@map("sys_tenant_billing")
}

/// 账单明细表
model SysTenantBillingItem {
  id          Int       @id @default(autoincrement())
  billingId   Int       @map("billing_id")
  name        String    @db.VarChar(100)                         // 项目名称
  type        String    @db.VarChar(50)                          // package, overage, other
  amount      Decimal   @db.Decimal(10, 2)
  description String?   @db.VarChar(500)

  billing     SysTenantBilling @relation(fields: [billingId], references: [id], onDelete: Cascade)

  @@index([billingId])
  @@map("sys_tenant_billing_item")
}

/// 租户审计日志表（增强版）
model SysTenantAuditLog {
  id            BigInt    @id @default(autoincrement())
  tenantId      String    @map("tenant_id") @db.VarChar(20)
  operatorId    Int       @map("operator_id")
  operatorName  String    @map("operator_name") @db.VarChar(50)
  actionType    String    @map("action_type") @db.VarChar(50)    // login, logout, create, update, delete, permission_change, config_change, export
  actionDesc    String    @map("action_desc") @db.VarChar(500)   // 操作描述
  module        String    @db.VarChar(100)                       // 操作模块
  ipAddress     String    @map("ip_address") @db.VarChar(128)
  userAgent     String?   @map("user_agent") @db.VarChar(500)
  requestUrl    String?   @map("request_url") @db.VarChar(500)
  requestMethod String?   @map("request_method") @db.VarChar(10)
  requestParams String?   @map("request_params") @db.Text
  beforeData    String?   @map("before_data") @db.Text           // 操作前数据（JSON）
  afterData     String?   @map("after_data") @db.Text            // 操作后数据（JSON）
  responseData  String?   @map("response_data") @db.Text
  operateTime   DateTime  @default(now()) @map("operate_time") @db.Timestamp(6)

  @@index([tenantId])
  @@index([operatorId])
  @@index([actionType])
  @@index([operateTime])
  @@index([tenantId, operateTime])
  @@index([tenantId, actionType, operateTime])
  @@map("sys_tenant_audit_log")
}

// ==================== OSS 相关表 ====================

/// OSS 配置表
model SysOssConfig {
  ossConfigId   Int       @id @default(autoincrement()) @map("oss_config_id")
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  configKey     String    @map("config_key") @db.VarChar(100)
  accessKey     String    @map("access_key") @db.VarChar(255)
  secretKey     String    @map("secret_key") @db.VarChar(255)
  bucketName    String    @map("bucket_name") @db.VarChar(255)
  prefix        String?   @db.VarChar(255)
  endpoint      String    @db.VarChar(255)
  domain        String?   @db.VarChar(255)
  isHttps       String    @default("N") @map("is_https") @db.Char(1)
  region        String?   @db.VarChar(100)
  accessPolicy  String    @default("1") @map("access_policy") @db.Char(1)
  status        String    @default("1") @db.Char(1)
  ext1          String?   @db.VarChar(255)
  remark        String?   @db.VarChar(500)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@unique([tenantId, configKey])
  @@index([tenantId])
  @@map("sys_oss_config")
}

/// OSS 文件表
model SysOss {
  ossId         BigInt    @id @default(autoincrement()) @map("oss_id")
  tenantId      String    @default("000000") @map("tenant_id") @db.VarChar(20)
  fileName      String    @map("file_name") @db.VarChar(255)
  originalName  String    @map("original_name") @db.VarChar(255)
  fileSuffix    String    @map("file_suffix") @db.VarChar(50)
  url           String    @db.VarChar(500)
  size          BigInt    @default(0)
  service       String    @default("local") @db.VarChar(50)
  delFlag       String    @default("0") @map("del_flag") @db.Char(1)
  createBy      String    @default("") @map("create_by") @db.VarChar(64)
  createTime    DateTime? @map("create_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)
  updateBy      String    @default("") @map("update_by") @db.VarChar(64)
  updateTime    DateTime? @map("update_time") @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(6)

  @@index([tenantId])
  @@index([fileName])
  @@map("sys_oss")
}
